#!/bin/sh
# mise bootstrap script
# Downloads and runs mise if not already installed
# Generated by: mise generate bootstrap

set -eu

MISE_VERSION="2025.1.0"
MISE_INSTALL_PATH="${MISE_INSTALL_PATH:-$HOME/.local/bin/mise}"

download_mise() {
    OS="$(uname -s | tr '[:upper:]' '[:lower:]')"
    ARCH="$(uname -m)"
    case "$ARCH" in
        x86_64) ARCH="x64" ;;
        aarch64|arm64) ARCH="arm64" ;;
    esac

    URL="https://github.com/jdx/mise/releases/download/v${MISE_VERSION}/mise-v${MISE_VERSION}-${OS}-${ARCH}"

    echo "Downloading mise v${MISE_VERSION}..." >&2
    mkdir -p "$(dirname "$MISE_INSTALL_PATH")"

    if command -v curl >/dev/null 2>&1; then
        curl -fsSL "$URL" -o "$MISE_INSTALL_PATH"
    elif command -v wget >/dev/null 2>&1; then
        wget -qO "$MISE_INSTALL_PATH" "$URL"
    else
        echo "Error: curl or wget required" >&2
        exit 1
    fi

    chmod +x "$MISE_INSTALL_PATH"
}

# Check if mise is installed and correct version
if [ -x "$MISE_INSTALL_PATH" ]; then
    INSTALLED_VERSION="$("$MISE_INSTALL_PATH" --version 2>/dev/null | head -1 | cut -d' ' -f2 || echo "")"
    if [ "$INSTALLED_VERSION" != "$MISE_VERSION" ]; then
        download_mise
    fi
else
    download_mise
fi

exec "$MISE_INSTALL_PATH" "$@"
